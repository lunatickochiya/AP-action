From e13d3b2578bb456c422dc85501c7877693cd8c3a Mon Sep 17 00:00:00 2001
From: lunatickochiya <125438787@qq.com>
Date: Mon, 11 Aug 2025 21:29:46 +0800
Subject: [PATCH] ath79:add lunaticbox support lan wan ath79:add lunaticbox
 support

---
 package/boot/uboot-envtools/files/ath79       |  2 ++
 .../ath79/dts/qca9531_lunatic-box-lan.dts     | 18 +++++++++++++++
 .../ath79/dts/qca9531_lunatic-box-wan.dts     | 22 +++++++++++++++++++
 .../generic/base-files/etc/board.d/01_leds    |  2 ++
 .../generic/base-files/etc/board.d/02_network |  4 ++++
 target/linux/ath79/image/generic.mk           | 18 +++++++++++++++
 6 files changed, 66 insertions(+)
 create mode 100644 target/linux/ath79/dts/qca9531_lunatic-box-lan.dts
 create mode 100644 target/linux/ath79/dts/qca9531_lunatic-box-wan.dts

diff --git a/package/boot/uboot-envtools/files/ath79 b/package/boot/uboot-envtools/files/ath79
index c989e61bd5..c590813728 100644
--- a/package/boot/uboot-envtools/files/ath79
+++ b/package/boot/uboot-envtools/files/ath79
@@ -99,6 +99,8 @@ glinet,gl-ar300m-lite|\
 glinet,gl-ar300m-nand|\
 glinet,gl-ar300m-nor|\
 glinet,gl-ar300m16|\
+lunaticbox,wifi-lan|\
+lunaticbox,wifi-wan|\
 glinet,gl-s200-nor|\
 glinet,gl-s200-nor-nand)
 	idx="$(find_mtd_index u-boot-env)"
diff --git a/target/linux/ath79/dts/qca9531_lunatic-box-lan.dts b/target/linux/ath79/dts/qca9531_lunatic-box-lan.dts
new file mode 100644
index 0000000000..1cff9355bd
--- /dev/null
+++ b/target/linux/ath79/dts/qca9531_lunatic-box-lan.dts
@@ -0,0 +1,18 @@
+// SPDX-License-Identifier: GPL-2.0-or-later OR MIT
+// Base by GL.iNet AR-300M16 LunaticKochiya
+
+
+#include "qca9531_glinet_gl-ar300m.dtsi"
+
+/ {
+	compatible = "lunaticbox,wifi-lan", "qca,qca9531";
+	model = "Lunatic BOX WiFi For Things";
+};
+
+
+/delete-node/ &nand_flash;
+
+&nor_firmware {
+	compatible = "denx,uimage";
+	label = "firmware";
+};
diff --git a/target/linux/ath79/dts/qca9531_lunatic-box-wan.dts b/target/linux/ath79/dts/qca9531_lunatic-box-wan.dts
new file mode 100644
index 0000000000..2649728f64
--- /dev/null
+++ b/target/linux/ath79/dts/qca9531_lunatic-box-wan.dts
@@ -0,0 +1,22 @@
+// SPDX-License-Identifier: GPL-2.0-or-later OR MIT
+// Base by GL.iNet AR-300M16 LunaticKochiya
+
+
+#include "qca9531_glinet_gl-ar300m.dtsi"
+
+/ {
+	compatible = "lunaticbox,wifi-wan", "qca,qca9531";
+	model = "Lunatic BOX WiFi For Things";
+};
+
+
+/delete-node/ &nand_flash;
+
+&nor_firmware {
+	compatible = "denx,uimage";
+	label = "firmware";
+};
+
+&eth1 {
+	compatible = "syscon", "simple-mfd";
+};
diff --git a/target/linux/ath79/generic/base-files/etc/board.d/01_leds b/target/linux/ath79/generic/base-files/etc/board.d/01_leds
index 6409adb78a..5bd2b35fbb 100644
--- a/target/linux/ath79/generic/base-files/etc/board.d/01_leds
+++ b/target/linux/ath79/generic/base-files/etc/board.d/01_leds
@@ -28,6 +28,8 @@ glinet,6408|\
 glinet,6416|\
 glinet,gl-ar300m-lite|\
 glinet,gl-ar300m16|\
+lunaticbox,wifi-wan|\
+lunaticbox,wifi-lan|\
 pcs,cap324|\
 tplink,cpe605-v1|\
 tplink,cpe610-v1|\
diff --git a/target/linux/ath79/generic/base-files/etc/board.d/02_network b/target/linux/ath79/generic/base-files/etc/board.d/02_network
index dedbaf05b8..1a92e76248 100644
--- a/target/linux/ath79/generic/base-files/etc/board.d/02_network
+++ b/target/linux/ath79/generic/base-files/etc/board.d/02_network
@@ -54,6 +54,7 @@ ath79_setup_interfaces()
 	glinet,gl-usb150|\
 	hak5,wifi-pineapple-nano|\
 	huawei,ap6010dn|\
+	lunaticbox,wifi-lan|\
 	meraki,mr16|\
 	netgear,ex7300|\
 	netgear,ex7300-v2|\
@@ -610,6 +611,9 @@ ath79_setup_interfaces()
 		ucidef_add_switch "switch0" \
 			"0@eth0" "3:lan:1" "4:lan:2"
 		;;
+	lunaticbox,wifi-wan)
+		ucidef_set_interfaces_lan_wan "eth1" "eth0"
+		;;
 	*)
 		ucidef_set_interfaces_lan_wan "eth0" "eth1"
 		;;
diff --git a/target/linux/ath79/image/generic.mk b/target/linux/ath79/image/generic.mk
index 846a9acd20..f41deeaec7 100644
--- a/target/linux/ath79/image/generic.mk
+++ b/target/linux/ath79/image/generic.mk
@@ -3414,3 +3414,21 @@ define Device/zyxel_nbg6616
   SUPPORTED_DEVICES += nbg6616
 endef
 TARGET_DEVICES += zyxel_nbg6616
+
+define Device/lunatic-box-lan
+  SOC := qca9531
+  DEVICE_VENDOR := Lunatic-Box
+  DEVICE_MODEL := Wifi-Lan
+  IMAGE_SIZE := 16000k
+  SUPPORTED_DEVICES += lunaticbox,wifi-lan
+endef
+TARGET_DEVICES += lunatic-box-lan
+
+define Device/lunatic-box-wan
+  SOC := qca9531
+  DEVICE_VENDOR := Lunatic-Box
+  DEVICE_MODEL := Wifi-Wan
+  IMAGE_SIZE := 16000k
+  SUPPORTED_DEVICES += lunaticbox,wifi-wan
+endef
+TARGET_DEVICES += lunatic-box-wan
-- 
2.43.0

